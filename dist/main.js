function idGenerator(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()}function Execute(e,t,n){"use strict";var l=idGenerator(),c=document.createElement("li");c.id=l,document.getElementById("_instaext").appendChild(c),observeDOM(c,function(e){t(c.innerText),c.remove()}),n=n||{};var i=document.createElement("script");i.textContent="("+e+')("'+l+'",'+JSON.stringify(n)+")",(document.head||document.documentElement).appendChild(i),i.parentNode.removeChild(i)}function checkPeriodically(e,t,n){n=n||100,0==n?t(!1):e()?t(!0):setTimeout(function(){checkPeriodically(e,t,n-1)},100)}function isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}function clog(){for(var e in arguments)console.log(arguments[e])}function postCallback(e,t){t.action="callback."+e,port.postMessage(t)}var s=document.createElement("script");s.src=chrome.extension.getURL("inject.js"),s.onload=function(){this.remove()},(document.head||document.documentElement).appendChild(s);var observeDOM=function(){var e=window.MutationObserver||window.WebKitMutationObserver,t=window.addEventListener;return function(n,l){if(null!==n)if(e){var c=new e(function(e,t){(e[0].addedNodes.length||e[0].removedNodes.length)&&l(e)});c.observe(n,{childList:!0,subtree:!0})}else t&&(n.addEventListener("DOMNodeInserted",l,!1),n.addEventListener("DOMNodeRemoved",l,!1))}}(),buffer=document.createElement("ul");buffer.id="_instaext",document.documentElement.appendChild(buffer);var pageId=idGenerator(),port;setTimeout(function(){var e="page."+pageId;port=chrome.runtime.connect({name:e}),port.onMessage.addListener(function(e){void 0!==e.action&&void 0!==controller[e.action]&&void 0!==controller[e.action]&&controller[e.action](e)})},1e3);var controller={gotoProfile:function(e){window.location.href="/"+e.username+"/"},gotoHomePage:function(e){var t=document.querySelector("#react-root>section>nav>div>div>div>div:nth-child(3)>div>div:nth-child(3)>a");null!=t&&(window.location.href=t.getAttribute("href"))},getFollowersCount:function(e){var t=document.querySelector("#react-root>section>main>article>header>div:nth-child(2)>ul>li:nth-child(2)>a>span");null!=t?e.callback({Result:t.textContent}):e.callback({Result:0})},getFollowingsCount:function(e){var t=document.querySelector("#react-root>section>main>article>header>div:nth-child(2)>ul>li:nth-child(3)>a>span");null!=t?e.callback({Result:t.textContent}):e.callback({Result:0})},openFollowers:function(e){var t=document.querySelector("#react-root>section>main>article>header>div:nth-child(2)>ul>li:nth-child(2)>a");if(null!=t){var n;Execute(function(e){window.registerRequest(e,"/query/")},function(e){n=JSON.parse(e)}),t.click(),checkPeriodically(function(){return null==document.querySelector("div>div[role=dialog]>div:nth-child(2)>div>div:nth-child(2)>ul>li:last-child>div.spiSpinner")&&document.querySelectorAll("div>div[role=dialog]>div:nth-child(2)>div>div:nth-child(2)>ul>li").length>0},function(t){postCallback(e.callbackId,{result:t,response:n})})}else postCallback(e.callbackId,{result:!1})},loadMoreFollowers:function(e){var t,n=document.querySelector("div>div[role=dialog]>div:nth-child(2)>div>div:nth-child(2)");Execute(function(e){window.registerRequest(e,"/query/")},function(e){t=JSON.parse(e)}),setTimeout(function(){n.scrollTop=n.scrollHeight,checkPeriodically(function(){return void 0!=t},function(n){postCallback(e.callbackId,{result:n,response:t})})},100)},followFromList:function(e){var t=document.querySelector('div>div[role=dialog]>div:nth-child(2)>div>div:nth-child(2)>ul>li a[title="'+e.username+'"]');if(null!=t){var n=t.parentElement.parentElement.parentElement.parentElement.querySelector("button");null!=n?(Execute(function(e,t){window.registerRequest(e,"/web/friendships/"+t.userId+"/follow/")},function(t){query=JSON.parse(t),postCallback(e.callbackId,{result:!0,response:query})},{userId:e.userId}),n.click()):postCallback(e.callbackId,{result:!1})}else postCallback(e.callbackId,{result:!1})},getCurrentPage:function(e){var t=document.querySelector("span>section>main>article>header>div:nth-child(2)>div>h1");null!=t?postCallback(e.callbackId,{result:!0,username:t.innerText}):postCallback(e.callbackId,{result:!1})},getCurrentUser:function(e){Execute(function(e){window.getViewer(e)},function(t){user=JSON.parse(t),postCallback(e.callbackId,{result:!0,user:user})})},getSharedData:function(e){Execute(function(e){window.getSharedData(e)},function(t){sharedData=JSON.parse(t),postCallback(e.callbackId,{result:!0,sharedData:sharedData})})},openFollowings:function(e){var t=document.querySelector("#react-root>section>main>article>header>div:nth-child(2)>ul>li:nth-child(3)>a");if(null!=t){var n;Execute(function(e){window.registerRequest(e,"/query/")},function(e){n=JSON.parse(e)}),t.click(),checkPeriodically(function(){return null==document.querySelector("div>div[role=dialog]>div:nth-child(2)>div>div:nth-child(2)>ul>li:last-child>div.spiSpinner")&&document.querySelectorAll("div>div[role=dialog]>div:nth-child(2)>div>div:nth-child(2)>ul>li").length>0},function(t){postCallback(e.callbackId,{result:t,response:n})})}else postCallback(e.callbackId,{result:!1})},loadMoreFollowings:function(e){var t,n=document.querySelector("div>div[role=dialog]>div:nth-child(2)>div>div:nth-child(2)");Execute(function(e){window.registerRequest(e,"/query/")},function(e){t=JSON.parse(e)}),setTimeout(function(){n.scrollTop=n.scrollHeight,checkPeriodically(function(){return void 0!=t},function(n){postCallback(e.callbackId,{result:n,response:t})})},100)},unfollowFromList:function(e){var t=document.querySelector('div>div[role=dialog]>div:nth-child(2)>div>div:nth-child(2)>ul>li a[title="'+e.username+'"]');if(null!=t){var n=t.parentElement.parentElement.parentElement.parentElement.querySelector("button");null!=n?(Execute(function(e,t){window.registerRequest(e,"/web/friendships/"+t.userId+"/unfollow/")},function(t){query=JSON.parse(t),postCallback(e.callbackId,{result:!0,user:{userId:e.userId,username:e.username},response:query})},{userId:e.userId}),n.click()):postCallback(e.callbackId,{result:!1})}else postCallback(e.callbackId,{result:!1})},getProfileInfo:function(e){Execute(function(e){window.getProfile(e)},function(t){user=JSON.parse(t),null==user?postCallback(e.callbackId,{result:!1}):postCallback(e.callbackId,{result:!0,user:user})})},unfollowFromPage:function(e){var t=document.querySelector("span>section>main>article>header>div:nth-child(2)>div>span:nth-child(2)>span:nth-child(1)>button");null==t&&(t=document.querySelector("span>section>main>article>header>div:nth-child(2)>div>span:nth-child(2)>button")),null!=t?(Execute(function(e,t){window.registerRequest(e,"/web/friendships/"+t.userId+"/unfollow/")},function(t){query=JSON.parse(t),postCallback(e.callbackId,{result:!0,user:{userId:e.userId,username:e.username},response:query})},{userId:e.userId}),t.click()):postCallback(e.callbackId,{result:!1})},getPosts:function(e){Execute(function(e){window.getPosts(e)},function(t){var n=JSON.parse(t);null==n?postCallback(e.callbackId,{result:!1}):postCallback(e.callbackId,{result:!0,media:n})})},loadMorePosts:function(e){var t=document.querySelector("span>section>main>article>div:nth-child(2)>div:nth-child(3)>a");Execute(function(e,t){window.registerRequest(e,"/query/")},function(t){var n=JSON.parse(t);postCallback(e.callbackId,{result:!0,response:n})},{userId:e.userId}),null!=t?t.click():setTimeout(function(){document.body.scrollTop=document.body.scrollHeight},100)},openPost:function(e){var t=document.querySelector('a[href^="/p/'+e.code+'/?taken-by="]');null!=t?(Execute(function(e,t){window.registerRequest(e,t.url)},function(t){var n=JSON.parse(t);postCallback(e.callbackId,{result:!0,response:n})},{url:t.getAttribute("href")+"&__a=1"}),t.click()):postCallback(e.callbackId,{result:!1})},loadMoreComments:function(e){var t=document.querySelector('div[role="dialog"]>div:nth-child(2)>div:nth-child(1)>article>div:nth-child(3)>ul>li:nth-child(1)>button');null==t&&(t=document.querySelector('div[role="dialog"]>div:nth-child(2)>div:nth-child(1)>article>div:nth-child(3)>ul>li:nth-child(2)>button')),null!=t&&t.textContent.indexOf("comments")!=-1&&(Execute(function(e){window.registerRequest(e,"/query/")},function(t){var n=JSON.parse(t);postCallback(e.callbackId,{result:!0,response:n})}),0==t.textContent.indexOf("view all")&&t.click(),setTimeout(function(){t.click()},100))},followFromPage:function(e){var t=document.querySelector("span>section>main>article>header>div:nth-child(2)>div>span:nth-child(2)>span:nth-child(1)>button");null==t&&(t=document.querySelector("span>section>main>article>header>div:nth-child(2)>div>span:nth-child(2)>button")),null!=t?(Execute(function(e,t){window.registerRequest(e,"/web/friendships/"+t.userId+"/follow/")},function(t){query=JSON.parse(t),postCallback(e.callbackId,{result:!0,user:{userId:e.userId,username:e.username},response:query})},{userId:e.userId}),t.click()):postCallback(e.callbackId,{result:!1})}};